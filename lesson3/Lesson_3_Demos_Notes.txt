# Lesson 3 Demos and Notes

# Lesson Overview: Slides

# Review Ansible Testing setup: Control VM (Ubuntu) +  App and Db (OEL7.x)
# Control VM  - use desktop image - comes with Gnome

# Control server.
config.vm.define "control" do |ctl|
ctl.vm.hostname = "control.example.com"
ctl.vm.box = "peru/ubuntu-20.04-desktop-amd64"
ctl.vm.network :private_network, ip:"192.168.60.10"
end

#Confirm we have VSC, Ansible, Linters installed


# Use GitHib for source control manamgment )(SCM)
# Create/log into GitHub account
# create repository and get clone link


# install git if needed: https://git-scm.com/download/win
git clone https://github.com/joestechland/devops_class.git
# clone repo with url - enter username/password
# In Control VM< start VSC and Open folder for cloned repo
# Test edit and add, commit and push
# Check Github for changes

# create keys ssh-keygen
# Control VM - run ansible script to configure (update, VSC, + account, +ansible +linters -bloatware)
# Create shared folder to c:\devops_class


# Create keys for passwordless ssh to the vms
# on Control: 
ssh-keygen
#CHange filename to ansible (/home/vagrant/.ssh/ansible)
enter password: none
. copy keys to other servers
ssh-copy-id vagrant@192.168.60.11
#Yes to continue connecting & password is vagrant
ssh-copy-id vagrant@192.168.60.12
#Yes to continue connecting & password is vagrant
# run ssh-agent
eval $(ssh-agent)
# Add your keys to the session:
ssh-add
try ssh to each server
ssh vagrant@192.168.60.11
ssh vagrant@192.168.60.12
# this should work - MAKE SURE to exit ssh when done with the server!
. Back at vagrant@control, try to ping the servers with ansible
ansible all -i "192.168.60.11, 192.168.60.12" -m ping

## Alternative use ansible key_file
in ansible.cfg
private_key_file =  ~/.ssh/ansible

If all this works, you can try the demos from class or play around yourself.

Remember to exit vagrant@control to run vagrant commands on the VMs:
vagrant suspend -a
#will suspend the servers
vagrant resume
#restarts them or you can use the Virtual Box UI
vagrant destroy will destroy the VMs - if you do this, you can use vagrant up to re-create them but you'll need to re-create all the keys.


. Create an inventory file on vagrant@control
#create a new file named inventory:
#start Visual Studio Code:
execute: code
File New File inventory.ini
[servers]
192.168.60.11
192.168.60.12

# Now run ansible ad hoc commands without list of servers:
ansible all -i inventory.ini -m ping

# Create config file
# add inventory private_key_file
# Rereun ansible ad hoc w/o inventory
